
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Batch Processing &#8212; gcmstools Documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Appendix A: Running Code Samples" href="appendA.html" />
    <link rel="prev" title="Isotopic Distribution Analysis" href="isotope.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>gcmstools</span></a></h1>
        <h2 class="heading"><span>Batch Processing</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="isotope.html">Isotopic Distribution Analysis</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="appendA.html">Appendix A: Running Code Samples</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="batch-processing">
<h1>Batch Processing<a class="headerlink" href="#batch-processing" title="Permalink to this heading">¶</a></h1>
<p>All of the previous steps can be automated using the <code class="docutils literal notranslate"><span class="pre">proc_data</span></code> fuction
located in the <code class="docutils literal notranslate"><span class="pre">gcmstools.general</span></code> module.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">gcmstools.general</span> <span class="kn">import</span> <span class="n">proc_data</span>
</pre></div>
</div>
<p>This function only has two required arguments: 1) the path to the folder that
contains <em>all</em> of the GCMS files and 2) the name of the HDF data file that
you’d like to generate. In this example, our data is in the folder “data” and
our processed data file is called “data.h5”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">proc_data</span><span class="p">(</span><span class="s1">&#39;data/&#39;</span><span class="p">,</span> <span class="s1">&#39;data.h5&#39;</span><span class="p">)</span>
<span class="o">...</span> <span class="c1"># Lots of stuff will get printed at this point.</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">proc_data</span></code> function accepts numerous keyword arguments to allow some
process control.</p>
<ul>
<li><p><em>filetype=’aia’</em> : This flag can be used to control the type of GCMS objects
used for processing the data in your folder. The default value <code class="docutils literal notranslate"><span class="pre">'aia'</span></code>
uses the <code class="docutils literal notranslate"><span class="pre">AiaFile</span></code> object. See <a class="reference internal" href="basics.html"><span class="doc">Basic Setup</span></a> for detailed information.</p></li>
<li><p><em>reffile=None</em> : Pass the name of a reference file for referencing your GCMS
data. The default is <code class="docutils literal notranslate"><span class="pre">None</span></code>, so no referencing will be done. Otherwise,
the reference object will be determined by the file extension. For example,
<code class="docutils literal notranslate"><span class="pre">reffile='ref_specs.txt'</span></code> will create a <code class="docutils literal notranslate"><span class="pre">TxtReference</span></code> object using the
file “ref_specs.txt” (which must exist of course). See <a class="reference internal" href="fitting.html"><span class="doc">Referencing and Fitting</span></a> for
more information.</p></li>
<li><p><em>fittype=None</em> : Set the fitting type to use for fitting the GCMS data. See
<a class="reference internal" href="fitting.html"><span class="doc">Referencing and Fitting</span></a> for detailed information. The valid choices are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'nnls'</span></code> for non-negative least squares fitting.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><em>calfile=None</em> : Pass in the name of a calibration csv file to generate
calibration curves and integrate the data. For example,
<code class="docutils literal notranslate"><span class="pre">calfile='calibration.csv'</span></code> will calibrate your data using the information
in the csv file “calibration.csv”. See <a class="reference internal" href="calibration.html"><span class="doc">Calibration and Concentration Determination</span></a> for detailed
information, especially on the expected structure of the csv file.</p></li>
<li><p><em>picts=False</em> : Set this argument to true if you want to generate pictures
of your calibration curves and data fits. These calibration curves will be
placed in the folder “cal”, and plots of integrals with concentrations will
be place in the folder “proc”. Be careful! All files in these folders will
be deleted before the plots are generated. Also, if you have a lot of data
files, this process can be very slow. It is possible to view these plots
after processing.  See <a class="reference internal" href="calibration.html"><span class="doc">Calibration and Concentration Determination</span></a> for detailed information.</p></li>
<li><p><em>chunk_size=4</em> : This sets the number of files that will be processed at any
given time. This keeps the total number of opened GCMS files to a minimum,
which is important if you have a large number of files to process. You
probably don’t need to change this.</p></li>
<li><p><em>multiproc=False</em> : Setting this argument to <code class="docutils literal notranslate"><span class="pre">True</span></code> will use IPython’s
parallel machinery to run a lot of the processing using multiple cores on
your processor.  Before using this command, you must start an IPython node
cluster from the command line.  Open a new terminal, and type the following
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>home&gt;$ ipcluster start -n 2
</pre></div>
</div>
<p>This will start a cluster of two (<code class="docutils literal notranslate"><span class="pre">-n</span> <span class="pre">2</span></code>) nodes. You can have up to one
node per core on your processor. Setting this number greater than the number
of cores will result in a degradation of performance. To stop the node
cluster, type <code class="docutils literal notranslate"><span class="pre">Ctrl-c</span></code> from the terminal where you started the cluster. Or
else, you can stop it from another terminal using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>home&gt;$ ipcluster stop
</pre></div>
</div>
<p>This only works for processing the files, not for generating plots. So
plotting your calibration data will still be very slow for a lot of data
files.</p>
<p>See <a class="reference external" href="http://ipython.org/ipython-doc/dev/parallel/">IPython’s parallel documentation</a> for more information.</p>
</li>
<li><p>This function can also accept all keyword arguments for any file type,
reference, fitting, and calibration objects. See their documentation for
more information.</p></li>
</ul>
<section id="complete-processing-command">
<h2>Complete Processing Command<a class="headerlink" href="#complete-processing-command" title="Permalink to this heading">¶</a></h2>
<p>A complete version of this processing command might look like the following.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">proc_data</span><span class="p">(</span><span class="s1">&#39;data/&#39;</span><span class="p">,</span> <span class="s1">&#39;data.h5&#39;</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;aia&#39;</span><span class="p">,</span> <span class="n">reffile</span><span class="o">=</span><span class="s1">&#39;ref_spects.txt&#39;</span><span class="p">,</span>
        <span class="n">fittype</span><span class="o">=</span><span class="s1">&#39;nnls&#39;</span><span class="p">,</span> <span class="n">calfile</span><span class="o">=</span><span class="s1">&#39;calibration.csv&#39;</span><span class="p">,</span> <span class="n">multiproc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">### Lot&#39;s of stuff gets printed</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The HDF file “data.h5” contains all of your data. See the <a class="reference internal" href="storage.html"><span class="doc">Data Storage</span></a>,
<a class="reference internal" href="calibration.html"><span class="doc">Calibration and Concentration Determination</span></a>, and <a class="reference internal" href="appendB.html"><span class="doc">Appendix B</span></a> for more information on how to view and
plot these data.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="isotope.html">Isotopic Distribution Analysis</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="appendA.html">Appendix A: Running Code Samples</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Ryan Nelson.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
  Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59963257-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>