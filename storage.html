
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Data Storage &#8212; gcmstools Documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Calibration and Concentration Determination" href="calibration.html" />
    <link rel="prev" title="Referencing and Fitting" href="fitting.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>gcmstools</span></a></h1>
        <h2 class="heading"><span>Data Storage</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="fitting.html">Referencing and Fitting</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="calibration.html">Calibration and Concentration Determination</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="data-storage">
<h1>Data Storage<a class="headerlink" href="#data-storage" title="Permalink to this heading">¶</a></h1>
<p>Processed data files can be stored on-disk using the <code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> object
located in the <code class="docutils literal notranslate"><span class="pre">gcmstools.datastore</span></code> module. Not only does this create a
convenient storage solution for processed data sets, it is also necessary when
running calibrations on a group of related data sets. The file is a <a class="reference external" href="http://www.hdfgroup.org/HDF5/">HDF
file</a>, which is an open-source high performance data storage container
optimized for numerical data. Creation and manipulation of this file is
controlled using a combination of two Python libraries: <a class="reference external" href="http://www.pytables.org/moin">PyTables</a> and
<a class="reference external" href="http://pandas.pydata.org/">Pandas</a>. PyTables provides a high-level interface to create and modify HDF
files, and Pandas is a very powerful package for working with tabular data.
Both of these project have extensive documentation of their many advanced
features, so little detail on their usage is provided here.</p>
<section id="about-gcmsstore-implementation">
<h2>About GcmsStore Implementation<a class="headerlink" href="#about-gcmsstore-implementation" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> object is a subclass of the Pandas <code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> object, so
it will contain all of the <cite>functions described for that object</cite>. The
<code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> class simply adds a number of custom functions specific for GCMS
data sets.</p>
</section>
<section id="create-open-the-container">
<h2>Create/Open the Container<a class="headerlink" href="#create-open-the-container" title="Permalink to this heading">¶</a></h2>
<p>A <em>gcmstools</em> <code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> object must be created with a file name argument.
If a file with this name already exists, it will be opened for appending or
modification. The default behavior is to compress all the data going into this
file using the ‘blosc’ compression library and the highest compression level
(9). See the Pandas <code class="docutils literal notranslate"><span class="pre">HDFStore</span></code> documentation for other accepted keyword
arguments, especially the compression arguments if different values are
required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="kn">from</span> <span class="nn">gcmstools.datastore</span> <span class="kn">import</span> <span class="n">GcmsStore</span>

<span class="n">In</span> <span class="p">:</span> <span class="n">h5</span> <span class="o">=</span> <span class="n">GcmsStore</span><span class="p">(</span><span class="s1">&#39;data.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="closing-the-file">
<h2>Closing the File<a class="headerlink" href="#closing-the-file" title="Permalink to this heading">¶</a></h2>
<p>In general, you will want to close the HDF file when you’re done, although
this is not strictly necessary.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># Only do this when you&#39;re done</span>
</pre></div>
</div>
</section>
<section id="recompressing-the-hdf-file">
<h2>Recompressing the HDF File<a class="headerlink" href="#recompressing-the-hdf-file" title="Permalink to this heading">¶</a></h2>
<p>HDF files are designed to be written once and read many times. If you are
repeatedly adding new files to the HDF storage container, the file size may
become much larger than seems necessary. You can recompress the file using the
<code class="docutils literal notranslate"><span class="pre">compress</span></code> method (which first closes the HDF file).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">compress</span><span class="p">()</span> <span class="c1"># This closes the file as well.</span>
</pre></div>
</div>
</section>
<section id="adding-data">
<h2>Adding Data<a class="headerlink" href="#adding-data" title="Permalink to this heading">¶</a></h2>
<p>Added files to this storage container is done using the <code class="docutils literal notranslate"><span class="pre">append_files</span></code>
method, which can take either a single data object or a list of objects, if
you have many objects to add at one time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">append_files</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">HDF</span> <span class="n">Appending</span><span class="p">:</span> <span class="n">datasample1</span><span class="o">.</span><span class="n">CDF</span>

<span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">append_files</span><span class="p">([</span><span class="n">otherdata1</span><span class="p">,</span> <span class="n">otherdata2</span><span class="p">])</span>
<span class="n">HDF</span> <span class="n">Appending</span><span class="p">:</span> <span class="n">otherdata1</span><span class="o">.</span><span class="n">CDF</span>
<span class="n">HDF</span> <span class="n">Appending</span><span class="p">:</span> <span class="n">otherdata2</span><span class="o">.</span><span class="n">CDF</span>
</pre></div>
</div>
<p>Data files can be added at any stage of the processing chain; however, the
calibration process will not work properly if you don’t reference/fit the data
first.  You can add an already existing data file as well. The GcmsStore
object will check if that file is different than the saved version before
overwriting the existing object. If it is not changed, then the file will be
skipped.</p>
</section>
<section id="viewing-the-file-list">
<span id="procfiles"></span><h2>Viewing the File List<a class="headerlink" href="#viewing-the-file-list" title="Permalink to this heading">¶</a></h2>
<p>You can see a list of the files that are stored in this file by viewing the
<code class="docutils literal notranslate"><span class="pre">files</span></code> attribute, which is a Pandas DataFrame.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">files</span>
          <span class="n">name</span>         <span class="n">filename</span>
<span class="mi">0</span>  <span class="n">datasample1</span>  <span class="n">datasample1</span><span class="o">.</span><span class="n">CDF</span>
<span class="mi">1</span>  <span class="n">otherdata1</span>   <span class="n">otherdata1</span><span class="o">.</span><span class="n">CDF</span>
<span class="mi">2</span>  <span class="n">otherdata2</span>   <span class="n">otherdata2</span><span class="o">.</span><span class="n">CDF</span>
</pre></div>
</div>
<p>There are two name columns in this table: “name” and “filename”. The latter is
the full file and path name as given when the GcmsFile object was created.
Keep in mind that the path information may not be correct if you’ve moved the
location of this storage file. In order to efficiently store the data on disk,
the full file name is internally simplified the “name”. This simplification
removes the path and file extension from the file name. In addition, it
replaces all “.”, “-”, and spaces characters with “_”. If the file name starts
with a number, the prefix “num” is added.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You will encounter problems if two or more file names simplify to the same
“name”.  However, if you’re file naming system does not produce unique file
names for different data sets, you will most certainly have more problems in
the long run than just using these programs.</p>
</div>
</section>
<section id="extracting-stored-data">
<h2>Extracting Stored Data<a class="headerlink" href="#extracting-stored-data" title="Permalink to this heading">¶</a></h2>
<p>You can extract data from the storage file using the <code class="docutils literal notranslate"><span class="pre">extract_gcms</span></code> method.
This function takes one argument which is the name of the dataset that you
want to extract. This name can be either the simplified name or the full
filename (with or without the path). The extracted data is the same file
object type as you stored originally.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">extracted</span> <span class="o">=</span> <span class="n">h5</span><span class="o">.</span><span class="n">extract_gcms</span><span class="p">(</span><span class="s1">&#39;datasample1&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">:</span> <span class="n">extracted</span><span class="o">.</span><span class="n">filetype</span>
<span class="n">Out</span><span class="p">:</span> <span class="s2">&quot;AiaFile&quot;</span>
</pre></div>
</div>
</section>
<section id="stored-data-tables">
<h2>Stored Data Tables<a class="headerlink" href="#stored-data-tables" title="Permalink to this heading">¶</a></h2>
<p>This HDF data file may contain a number of Pandas data tables (DataFrames)
with information about the files, calibration, etc. A list of currently
available tables can be obtained by directly examining the <code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> by
directly examining the <code class="docutils literal notranslate"><span class="pre">GcmsStore</span></code> instance. (Note: you won’t see these
attributes using <a class="reference internal" href="appendA.html#ipytab"><span class="std std-ref">tab completion</span></a>.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>In : h5
Out:
&lt;class &#39;pandas.io.pytables.HDFStore&#39;&gt;
File path: data.h5
/calibration            frame        (shape-&gt;[6,8])
/calinput               frame        (shape-&gt;[30,9])
/datacal                frame        (shape-&gt;[49,6])
/files                  frame        (shape-&gt;[1,2])
</pre></div>
</div>
<p>Directly viewing these tables is trivial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">:</span> <span class="n">h5</span><span class="o">.</span><span class="n">calibration</span>
<span class="n">Out</span><span class="p">:</span>
               <span class="n">Start</span>  <span class="n">Stop</span>  <span class="n">Standard</span>         <span class="n">slope</span>      <span class="n">intercept</span>         <span class="n">r</span>  \
<span class="n">Compound</span>
<span class="n">benzene</span>          <span class="mf">2.9</span>   <span class="mf">3.5</span>       <span class="n">NaN</span>  <span class="mf">38629.931565</span> <span class="o">-</span><span class="mf">367129.586850</span>  <span class="mf">0.998767</span>
<span class="n">phenol</span>          <span class="mf">14.6</span>  <span class="mf">15.1</span>       <span class="n">NaN</span>  <span class="mf">30248.192619</span>   <span class="mf">65329.897933</span>  <span class="mf">0.999136</span>
<span class="o">...</span>

                      <span class="n">p</span>       <span class="n">stderr</span>
<span class="n">Compound</span>
<span class="n">benzene</span>        <span class="mf">0.000052</span>  <span class="mf">1108.344872</span>
<span class="n">phenol</span>         <span class="mf">0.000030</span>   <span class="mf">726.257380</span>
<span class="o">...</span>
</pre></div>
</div>
<p>More information on using these tables is provided in <a class="reference internal" href="appendB.html"><span class="doc">Appendix B</span></a>.</p>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="fitting.html">Referencing and Fitting</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="calibration.html">Calibration and Concentration Determination</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Ryan Nelson.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
  Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59963257-2', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>